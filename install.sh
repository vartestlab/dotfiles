#!/bin/bash

# install.sh



# –¶–≤–µ—Ç–∞
GREEN=$'\033[0;32m'      # –ó–µ–ª–µ–Ω—ã–π
RED=$'\033[0;31m'        # –ö—Ä–∞—Å–Ω—ã–π
ORANGE=$'\033[38;5;208m' # –û—Ä–∞–Ω—å–∂–µ–≤—ã–π
CYAN=$'\033[0;36m'       # –ì–æ–ª—É–±–æ–π
RESET_COLOR=$'\033[0m'   # –°–±—Ä–æ—Å–∏—Ç—å —Ü–≤–µ—Ç

# –ü–æ–ª—É—á–∞–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
PROJECT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# –ò–º–µ–Ω–æ–≤–∞–Ω–∏—è –¥–ª—è "–º–æ–¥—É–ª–µ–π"
NAME_PROMPT_ZSH="zsh-prompt"
NAME_PROMPT_BASH="bash-prompt"
NAME_CONFIG_NVIM="nvim"

# –ú–∞—Å—Å–∏–≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
arrEndInstructions=()

# –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ –º–∞—Å—Å–∏–≤. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: addEndInstruction "instruction"
addEndInstruction() {
    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    local instruction="$1"	# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è  
    local isDuplicate=0		# –§–ª–∞–≥ "–µ—Å—Ç—å —Ç–∞–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —É–∂–µ –≤ –º–∞—Å—Å–∏–≤–µ –∏–ª–∏ –Ω–µ—Ç"
    # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∞—Å—Å–∏–≤–∞ 
    for item in "${arrEndInstructions[@]}"; do
	# –ï—Å–ª–∏ —Ç–∞–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —É–∂–µ –Ω–∞–π–¥–µ–Ω–∞ - –ø–æ–¥–Ω–∏–º–∞–µ–º —Ñ–ª–∞–≥ –¥—É–±–ª–∏–∫–∞—Ç–∞ –∏ –ø—Ä–µ—Ä—ã–≤–∞–µ–º for 
        if [[ "$item" == "$instruction" ]]; then isDuplicate=1; break; fi
    done
    # –ï—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–µ –≤ –º–∞—Å—Å–∏–≤
    if [[ $isDuplicate -eq 0 ]]; then arrEndInstructions+=("$instruction"); fi
}

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫
handlerSystemError() {
  # –°—Ä–∞–∑—É –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–¥ –æ—à–∏–±–∫–∏ 
  local exit_code=$?		
  # –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è
  println "‚ùå ERR:" "$RED" >&2
  println "–ö–æ–º–∞–Ω–¥–∞: $BASH_COMMAND" "$ORANGE" >&2
  println "–ö–æ–¥ –æ—à–∏–±–∫–∏: $exit_code" "$ORANGE" >&2
  println "–ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏: $LINENO" "$ORANGE" >&2
}
# –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏
trap 'handlerSystemError' ERR	# –ó–∞–¥–µ–π—Å—Ç–≤—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
set -e 				# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
set -o pipefail 		# –°—á–∏—Ç–∞—Ç—å –æ—à–∏–±–∫–æ–π –ø—Ä–æ–≤–∞–ª –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω–≤–µ–π–µ—Ä–µ (pipe)

# –í—ã–≤–µ—Å—Ç–∏ —Ü–≤–µ—Ç–Ω–æ–π —Ç–µ–∫—Å—Ç. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: print "text" "$COLOR"
print() {
    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    local text="$1"	# –¢–µ–∫—Å—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ 
    local color="$2" 	# –¶–≤–µ—Ç –≤—ã–≤–æ–¥–∞ 
    # –í—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç
    printf "%s" "${color}${text}${RESET_COLOR}"
}
# –í—ã–≤–µ—Å—Ç–∏ —Ü–≤–µ—Ç–Ω–æ–π —Ç–µ–∫—Å—Ç –∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫—É. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: println "text" "$COLOR"
println() {
    # –í—ã–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é print –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏
    print "$1" "$2"
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏
    echo ""
}

# –ó–∞–ø–∏—Å–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: writeLineInBackFile "line" "file"
writeLineInBackFile() {
    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–º–µ–Ω–Ω—ã–µ 
    local line="$1"	# –°—Ç—Ä–æ–∫–∞
    local file="$2"	# –§–∞–π–ª		
    # –ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –µ—â–µ –Ω–µ—Ç —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ 
    if ! grep -Fxq "$line" "$file"; then
	# –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ñ–∞–π–ª
        echo "$line" >> "$file"
	# –û—Ç–ª–∞–¥–∫–∞
        #echo "	- –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É $line –≤ $file"
    else
	# –û—Ç–ª–∞–¥–∫–∞
        #echo "	- –°—Ç—Ä–æ–∫–∞ $line —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ $file"
	print ""
    fi
}




# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
if [ $# -eq 0 ]; then
    println "‚ùå ERR: –í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞!" "$RED"
    echo ""
    echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:"
    print "$NAME_PROMPT_ZSH" "$GREEN";  echo "	# –°—Ç—Ä–æ–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è zsh"
    print "$NAME_PROMPT_BASH" "$GREEN"; echo "	# –°—Ç—Ä–æ–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è bash"
    print "$NAME_CONFIG_NVIM" "$GREEN"; echo "		# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Neovim"
    exit 1
fi


# –í—ã–≤–æ–¥
echo "–£—Å—Ç–∞–Ω–∞–ª–∏–≤–∞—é –º–æ–¥—É–ª–∏ ..."
echo ""

# –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
for arg in "$@"; do
    case $arg in

	# –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è zsh - 
        $NAME_PROMPT_ZSH)
	    # –í—ã–≤–æ–¥
	    print "[$NAME_PROMPT_ZSH] ... "
            # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ñ–∞–π–ª ~/.zshrc –±—É–¥–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
            touch "$HOME/.zshrc"
	    # –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–∞—Ü–∏—é —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤ ~/.zshrc
            writeLineInBackFile "source \"$PROJECT_DIR/zshrc/prompt.zsh\"" "$HOME/.zshrc"
	    # –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            println "‚úÖ OK" "$GREEN"
	    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å–∫—Ä—É–∫—Ü–∏–∏ –ø–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
	    addEndInstruction "–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É source ~/.zshrc"
            ;;

        # –ó–¥–µ—Å—å –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        # zsh-aliases)
        #     echo "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Zsh Aliases..."
        #     # ...–ª–æ–≥–∏–∫–∞ –¥–ª—è –∞–ª–∏–∞—Å–æ–≤...
        #     ;;
	
	# –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–Ω–∞–µ—Ç —Ç–∞–∫–æ–≥–æ –º–æ–¥—É–ª—è
        *)
            println "$arg ... ‚ö†Ô∏è–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–æ–¥—É–ª—å!" "$ORANGE"
            exit
	    ;;
    esac
done


# –í—ã–≤–æ–¥ –æ—Ç—Å—Ç—É–ø–∞
echo " "


# –ï—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -
if [ ${#arrEndInstructions[@]} -gt 0 ]; then
    # –í—ã–≤–æ–¥
    println "üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ß—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:" "$GREEN"
    # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞ –∏ –≤—ã–≤–æ–¥–∏–º
    for instruction in "${arrEndInstructions[@]}"; do print " - "; println "$instruction" "$ORANGE"; done
else
    # –í—ã–≤–æ–¥
    println "üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è." "$GREEN"
fi



















